# Basic Tutorial	åŸºç¡€æ•™ç¨‹

Graphene Django has a number of additional features that are designed to make working with Django easy. Our primary focus in this tutorial is to give a good understanding of how to connect models from Django ORM to Graphene object types.

Graphene Djangoæœ‰è®¸å¤šé™„åŠ çš„ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§æ—¨åœ¨ä½¿Djangoçš„ä½¿ç”¨æ›´åŠ å®¹æ˜“ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯å¦‚ä½•å°†Django ORMæ¨¡å‹è¿æ¥åˆ°Grapheneå¯¹è±¡ç±»å‹ã€‚

## Set up the Django project	å»ºç«‹Djangoé¡¹ç›®

We will set up the project, create the following:

æˆ‘ä»¬å°†è®¾ç½®é¡¹ç›®ï¼Œåˆ›å»ºä»¥ä¸‹å†…å®¹ï¼š

- A Django project called `cookbook`
- ä¸€ä¸ªåä¸ºçš„`Django`é¡¹ç›®
- An app within `cookbook` called `ingredients`
- ä¸€ä¸ªåä¸º `ingredients`çš„åº”ç”¨ç¨‹åº

```shell
# Create the project directory
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir cookbook
cd cookbook

# Create a virtualenv to isolate our package dependencies locally
#åˆ›å»ºä¸€ä¸ªvirtualenvæ¥åœ¨æœ¬åœ°éš”ç¦»åŒ…ä¾èµ–å…³ç³»
virtualenv env
source env/bin/activate  # On Windows use `env\Scripts\activate`

# Install Django and Graphene with Django support
#ä½¿ç”¨Djangoæ”¯æŒå®‰è£…Djangoå’ŒGraphene
pip install django graphene_django

# Set up a new project with a single application
#ä½¿ç”¨å•ä¸ªåº”ç”¨ç¨‹åºè®¾ç½®æ–°é¡¹ç›®
django-admin startproject cookbook .  # Note the trailing '.' character
cd cookbook
django-admin startapp ingredients
```

Now sync your database for the first time:

ç°åœ¨ç¬¬ä¸€æ¬¡åŒæ­¥æ•°æ®åº“ï¼š

```shell
python manage.py migrate
```

Letâ€™s create a few simple models...

è®©æˆ‘ä»¬åˆ›å»ºå‡ ä¸ªç®€å•çš„æ¨¡å‹...

### Defining our models	å®šä¹‰æˆ‘ä»¬çš„æ¨¡å‹

Letâ€™s get started with these models:

è®©æˆ‘ä»¬ä»è¿™äº›æ¨¡å‹å¼€å§‹ï¼š

```python
# cookbook/ingredients/models.py
from django.db import models

class Category(models.Model):
    name = models.CharField(max_length=100)

    def __str__(self):
        return self.name

class Ingredient(models.Model):
    name = models.CharField(max_length=100)
    notes = models.TextField()
    category = models.ForeignKey(
        Category, related_name="ingredients", on_delete=models.CASCADE
    )

    def __str__(self):
        return self.name
```

Add ingredients as INSTALLED_APPS:

å°†` ingredients`æ·»åŠ åˆ°`INSTALLED_APPS`ï¼š

```python
# cookbook/settings.py

INSTALLED_APPS = [
    ...
    # Install the ingredients app
    # å®‰è£…é…æ–™åº”ç”¨ç¨‹åº
    "cookbook.ingredients",
]
```

Donâ€™t forget to create & run migrations:

<p style="color:#f0f">ä¸è¦å¿˜è®°åˆ›å»ºå’Œè¿è¡Œè¿ç§»ï¼š</p>

```shell
python manage.py makemigrations
python manage.py migrate
```

### Load some test data	åŠ è½½ä¸€äº›æµ‹è¯•æ•°æ®

Now is a good time to load up some test data. The easiest option will be to [download the ingredients.json](https://raw.githubusercontent.com/graphql-python/graphene-django/master/examples/cookbook/cookbook/ingredients/fixtures/ingredients.json) fixture and place it in `cookbook/ingredients/fixtures/ingredients.json`. You can then run the following:

ç°åœ¨æ˜¯åŠ è½½ä¸€äº›æµ‹è¯•æ•°æ®çš„å¥½æ—¶æœºã€‚æœ€ç®€å•çš„é€‰æ‹©æ˜¯ä¸‹è½½ [ingredients.json](https://raw.githubusercontent.com/graphql-python/graphene-django/master/examples/cookbook/cookbook/components/fixtures/components.json)å›ºå®šå¹¶æ”¾åœ¨`cookbook/ingredients/fixtures/ingredients.json`. ç„¶åå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```shell
python manage.py loaddata ingredients

Installed 6 object(s) from 1 fixture(s)
```

Alternatively you can use the Django admin interface to create some data yourself. Youâ€™ll need to run the development server (see below), and create a login for yourself too (`python manage.py createsuperuser`).

æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Djangoç®¡ç†æ¥å£è‡ªå·±åˆ›å»ºä¸€äº›æ•°æ®ã€‚æ‚¨éœ€è¦è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼ˆè§ä¸‹æ–‡ï¼‰ï¼Œå¹¶ä¸ºè‡ªå·±åˆ›å»ºä¸€ä¸ªç™»å½•åï¼ˆ`python manage.py createsuperuser`ï¼‰ã€‚

Register models with admin panel:

å‘ç®¡ç†é¢æ¿æ³¨å†Œæ¨¡å‹ï¼š

```python
# cookbook/ingredients/admin.py
from django.contrib import admin
from cookbook.ingredients.models import Category, Ingredient

admin.site.register(Category)
admin.site.register(Ingredient)
```

## Hello GraphQL - Schema and Object Types	ä½ å¥½GraphQL-æ¨¡å¼å’Œå¯¹è±¡ç±»å‹

In order to make queries to our Django project, we are going to need few things:

ä¸ºäº†å¯¹Djangoé¡¹ç›®è¿›è¡ŒæŸ¥è¯¢ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹å‡ ç‚¹ï¼š

- Schema with defined object types
- å·²å®šä¹‰å¯¹è±¡ç±»å‹çš„æ¶æ„
- A view, taking queries as input and returning the result
- è§†å›¾ï¼Œå°†æŸ¥è¯¢ä½œä¸ºè¾“å…¥å¹¶è¿”å›ç»“æœ

GraphQL presents your objects to the world as a graph structure rather than a more hierarchical structure to which you may be accustomed. In order to create this representation, Graphene needs to know about each *type* of object which will appear in the graph.

GraphQLå°†æ‚¨çš„å¯¹è±¡ä½œä¸ºä¸€ä¸ªå›¾ç»“æ„å‘ˆç°ç»™ä¸–ç•Œï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ‚¨å¯èƒ½ä¹ æƒ¯çš„æ›´å…·å±‚æ¬¡ç»“æ„çš„ç»“æ„ã€‚ä¸ºäº†åˆ›å»ºè¿™ç§è¡¨ç¤ºï¼ŒGrapheneéœ€è¦çŸ¥é“å°†å‡ºç°åœ¨å›¾å½¢ä¸­çš„æ¯ç§*ç±»å‹*å¯¹è±¡ã€‚

This graph also has a *root type* through which all access begins. This is the `Query` class below.

æ­¤å›¾è¿˜å…·æœ‰ä¸€ä¸ª*æ ¹ç±»å‹*ï¼Œæ‰€æœ‰è®¿é—®éƒ½é€šè¿‡å®ƒå¼€å§‹ã€‚è¿™æ˜¯ä¸‹é¢çš„`Query`ç±»ã€‚

To create GraphQL types for each of our Django models, we are going to subclass the `DjangoObjectType` class which will automatically define GraphQL fields that correspond to the fields on the Django models.

ä¸ºäº†ä¸ºæ¯ä¸ªDjangoæ¨¡å‹åˆ›å»ºGraphQLç±»å‹ï¼Œæˆ‘ä»¬è¦å°†`DjangoObjectType`ç±»åˆ†ç±»ï¼Œè¯¥ç±»å°†è‡ªåŠ¨å®šä¹‰å¯¹åº”äºDjangoæ¨¡å‹ä¸Šçš„å­—æ®µçš„GraphQLå­—æ®µã€‚

After weâ€™ve done that, we will list those types as fields in the `Query` class.

å®Œæˆåï¼Œæˆ‘ä»¬å°†æŠŠè¿™äº›ç±»å‹ä½œä¸º`Query`ç±»ä¸­çš„å­—æ®µåˆ—å‡ºã€‚

Create `cookbook/schema.py` and type the following:

åˆ›å»º `cookbook/schema.py` å¹¶é”®å…¥ä»¥ä¸‹å†…å®¹ï¼š

```python
# cookbook/schema.py
import graphene
from graphene_django import DjangoObjectType

from cookbook.ingredients.models import Category, Ingredient

class CategoryType(DjangoObjectType):
    class Meta:
        model = Category
        fields = ("id", "name", "ingredients")

class IngredientType(DjangoObjectType):
    class Meta:
        model = Ingredient
        fields = ("id", "name", "notes", "category")

class Query(graphene.ObjectType):
    all_ingredients = graphene.List(IngredientType)
    category_by_name = graphene.Field(CategoryType, name=graphene.String(required=True))

    def resolve_all_ingredients(root, info):
        # We can easily optimize query count in the resolve method
        # æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨resolveæ–¹æ³•ä¸­ä¼˜åŒ–æŸ¥è¯¢è®¡æ•°
        return Ingredient.objects.select_related("category").all()

    def resolve_category_by_name(root, info, name):
        try:
            return Category.objects.get(name=name)
        except Category.DoesNotExist:
            return None

schema = graphene.Schema(query=Query)
```

You can think of this as being something like your top-level `urls.py` file.

ä½ å¯ä»¥æŠŠè¿™çœ‹ä½œæ˜¯ä½ çš„é«˜å±‚ `urls.py` æ–‡ä»¶ã€‚

## Testing everything so far	æµ‹è¯•åˆ°ç›®å‰ä¸ºæ­¢çš„ä¸€åˆ‡

We are going to do some configuration work, in order to have a working Django where we can test queries, before we move on, updating our schema.

æˆ‘ä»¬å°†åšä¸€äº›é…ç½®å·¥ä½œï¼Œä»¥ä¾¿æœ‰ä¸€ä¸ªå¯ç”¨çš„Djangoï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•æŸ¥è¯¢ï¼Œç„¶åç»§ç»­æ›´æ–°æˆ‘ä»¬çš„æ¨¡å¼ã€‚

### Update settings	æ›´æ–°è®¾ç½®

Next, install your app and GraphiQL in your Django project. GraphiQL is a web-based integrated development environment to assist in the writing and executing of GraphQL queries. It will provide us with a simple and easy way of testing our cookbook project.

æ¥ä¸‹æ¥ï¼Œåœ¨Djangoé¡¹ç›®ä¸­å®‰è£…åº”ç”¨ç¨‹åºå’ŒGraphiQLã€‚GraphiQLæ˜¯ä¸€ä¸ªåŸºäºwebçš„é›†æˆå¼€å‘ç¯å¢ƒï¼Œç”¨äºå¸®åŠ©ç¼–å†™å’Œæ‰§è¡ŒGraphQLæŸ¥è¯¢ã€‚å®ƒå°†ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªç®€å•æ˜“è¡Œçš„æ–¹æ³•æ¥æµ‹è¯•æˆ‘ä»¬çš„é£Ÿè°±é¡¹ç›®ã€‚

Add `graphene_django` to `INSTALLED_APPS` in `cookbook/settings.py`:

åœ¨`cookbook/settings.py`å†…æ·»åŠ `graphene_django` åˆ° `INSTALLED_APPS` ä¸­ï¼š

```python
# cookbook/settings.py

INSTALLED_APPS = [
    ...
    "graphene_django",
]
```

And then add the `SCHEMA` to the `GRAPHENE` config in `cookbook/settings.py`:

ç„¶ååœ¨`cookbook/settings.py`å†…å°†`SCHEMA`æ·»åŠ åˆ°`GRAPHENE`:

```python
# cookbook/settings.py

GRAPHENE = {
    "SCHEMA": "cookbook.schema.schema"
}
```

Alternatively, we can specify the schema to be used in the urls definition, as explained below.

æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šåœ¨urlå®šä¹‰ä¸­ä½¿ç”¨çš„æ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚

### Creating GraphQL and GraphiQL views	åˆ›å»ºGraphQLå’ŒGraphiQLè§†å›¾

Unlike a RESTful API, there is only a single URL from which GraphQL is accessed. Requests to this URL are handled by Grapheneâ€™s `GraphQLView` view.

This view will serve as GraphQL endpoint. As we want to have the aforementioned GraphiQL we specify that on the parameters with `graphiql=True`.

ä¸restfulapiä¸åŒï¼ŒGraphQLåªæœ‰ä¸€ä¸ªURLå¯ä¾›è®¿é—®ã€‚å¯¹è¿™ä¸ªURLçš„è¯·æ±‚ç”±Grapheneçš„â€œGraphQLViewâ€è§†å›¾å¤„ç†ã€‚

æ­¤è§†å›¾å°†ç”¨ä½œGraphQLç«¯ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬å¸Œæœ›æœ‰ä¸Šè¿°çš„GraphiQLï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å‚æ•°ä¸­æŒ‡å®šâ€œGraphiQL=Trueâ€ã€‚

```python
# cookbook/urls.py

from django.contrib import admin
from django.urls import path
from django.views.decorators.csrf import csrf_exempt

from graphene_django.views import GraphQLView

urlpatterns = [
    path("admin/", admin.site.urls),
    path("graphql", csrf_exempt(GraphQLView.as_view(graphiql=True))),
]
```

If we didnâ€™t specify the target schema in the Django settings file as explained above, we can do so here using:

å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¦‚ä¸Šæ‰€è¿°åœ¨Djangoè®¾ç½®æ–‡ä»¶ä¸­æŒ‡å®šç›®æ ‡æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ï¼š

```python
# cookbook/urls.py

from django.contrib import admin
from django.urls import path
from django.views.decorators.csrf import csrf_exempt

from graphene_django.views import GraphQLView

from cookbook.schema import schema

urlpatterns = [
    path("admin/", admin.site.urls),
    path("graphql", csrf_exempt(GraphQLView.as_view(graphiql=True, schema=schema))),
]
```

### Testing our GraphQL schema	æµ‹è¯•GraphQLæ¨¡å¼

Weâ€™re now ready to test the API weâ€™ve built. Letâ€™s fire up the server from the command line.

æˆ‘ä»¬ç°åœ¨å·²ç»å‡†å¤‡å¥½æµ‹è¯•æˆ‘ä»¬æ„å»ºçš„APIäº†ã€‚è®©æˆ‘ä»¬ä»å‘½ä»¤è¡Œå¯åŠ¨æœåŠ¡å™¨ã€‚

```shell
python manage.py runserver

Performing system checks...
Django version 3.0.7, using settings 'cookbook.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
```

Go to [localhost:8000/graphql](http://localhost:8000/graphql) and type your first query!

è½¬åˆ°[localhost:8000/graphql](http://localhost:8000/graphql)å¹¶é”®å…¥æ‚¨çš„ç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼

```json
query {
  allIngredients {
    id
    name
  }
}
```

If you are using the provided fixtures, you will see the following response:

å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨æ‰€æä¾›çš„å›ºä»¶ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹å“åº”ï¼š

```json
{
  "data": {
    "allIngredients": [
      {
        "id": "1",
        "name": "Eggs"
      },
      {
        "id": "2",
        "name": "Milk"
      },
      {
        "id": "3",
        "name": "Beef"
      },
      {
        "id": "4",
        "name": "Chicken"
      }
    ]
  }
}
```

Congratulations, you have created a working GraphQL server ğŸ¥³!

ç¥è´ºæ‚¨ï¼Œæ‚¨å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ­£åœ¨å·¥ä½œçš„GraphQLæœåŠ¡å™¨ğŸ¥³!

Note: Graphene [automatically camelcases](http://docs.graphene-python.org/en/latest/types/schema/#auto-camelcase-field-names) all field names for better compatibility with JavaScript clients.

æ³¨ï¼šGraphene[è‡ªåŠ¨camelcase](http://docs.graphene-python.org/en/latest/types/schema/#auto-camelcase-field-names) æ‰€æœ‰å­—æ®µåï¼Œä»¥ä¾¿æ›´å¥½åœ°ä¸JavaScriptå®¢æˆ·ç«¯å…¼å®¹ã€‚

## Getting relations	å»ºç«‹å…³ç³»

Using the current schema we can query for relations too. This is where GraphQL becomes really powerful!

ä½¿ç”¨å½“å‰æ¨¡å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥è¯¢å…³ç³»ã€‚è¿™å°±æ˜¯GraphQLå˜å¾—éå¸¸å¼ºå¤§çš„åœ°æ–¹ï¼

For example, we may want to get a specific categories and list all ingredients that are in that category.

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¾—åˆ°ä¸€ä¸ªç‰¹å®šçš„ç±»åˆ«ï¼Œå¹¶åˆ—å‡ºè¯¥ç±»åˆ«ä¸­çš„æ‰€æœ‰æˆåˆ†ã€‚

We can do that with the following query:

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢æ¥å®ç°ï¼š

```json
query {
  categoryByName(name: "Dairy") {
    id
    name
    ingredients {
      id
      name
    }
  }
}
```

This will give you (in case you are using the fixtures) the following result:

è¿™å°†ç»™æ‚¨ï¼ˆå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨å›ºå®šè£…ç½®ï¼‰ä»¥ä¸‹ç»“æœï¼š

```json
{
  "data": {
    "categoryByName": {
      "id": "1",
      "name": "Dairy",
      "ingredients": [
        {
          "id": "1",
          "name": "Eggs"
        },
        {
          "id": "2",
          "name": "Milk"
        }
      ]
    }
  }
}
```

We can also list all ingredients and get information for the category they are in:

æˆ‘ä»¬è¿˜å¯ä»¥åˆ—å‡ºæ‰€æœ‰æˆåˆ†å¹¶è·å–å…¶æ‰€å±ç±»åˆ«çš„ä¿¡æ¯ï¼š

```json
query {
  allIngredients {
    id
    name
    category {
      id
      name
    }
  }
}
```

## Summary	æ‘˜è¦

As you can see, GraphQL is very powerful and integrating Django models allows you to get started with a working server quickly.

å¦‚æ‚¨æ‰€è§ï¼ŒGraphQLéå¸¸å¼ºå¤§ï¼Œé›†æˆDjangoæ¨¡å‹å¯ä»¥è®©æ‚¨å¿«é€Ÿå¼€å§‹ä½¿ç”¨ä¸€ä¸ªæ­£å¸¸å·¥ä½œçš„æœåŠ¡å™¨ã€‚

If you want to put things like `django-filter` and automatic pagination in action, you should continue with the [Relay tutorial](https://docs.graphene-python.org/projects/django/en/latest/tutorial-relay/#relay-tutorial).

å¦‚æœæ‚¨æƒ³ä½¿ç”¨`django-filter`å’Œè‡ªåŠ¨åˆ†é¡µï¼Œæ‚¨åº”è¯¥ç»§ç»­[Relay tutorial](https://docs.graphene-python.org/projects/django/en/latest/tutorial-relay/#relay-tutorial)ã€‚

A good idea is to check the [Graphene](http://docs.graphene-python.org/en/latest/) documentation so that you are familiar with it as well.

ä¸€ä¸ªå¥½ä¸»æ„æ˜¯æ£€æŸ¥ [Graphene](http://docs.graphene-python.org/en/latest/) æ–‡æ¡£ï¼Œä»¥ä¾¿æ‚¨ä¹Ÿç†Ÿæ‚‰å®ƒã€‚